$schema: "1.0"
name: "1es-imaging"
image: microsoftvisualstudio_visualstudioplustools_vs-2022-ent-general-win11-m365-gen2
tasks:
  - name: ~/winget
    displayName: "Install VS Code"
    description: Install Visual Studio Code
    parameters:
      package: Microsoft.VisualStudioCode
  - name: ~/winget
    displayName: "Install Az CLI"
    description: Install Azure CLI
    parameters:
      package: Microsoft.AzureCLI
  - name: ~/powershell
    displayName: "Install DSC Preview"
    description: Install Desired State Configuration (DSC)
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\1es-imaging-catalog-01\1es-imaging\download-install-dsc.ps1
  - name: ~/powershell
    displayName: "Install Bicep CLI"
    description: Install Bicep CLI
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\1es-imaging-catalog-01\1es-imaging\download-install-bicep.ps1
  - name: ~/powershell
    displayName: "Apply DSC JSON Configuration"
    description: Apply the Desired State Configuration (DSC) via JSON to the system
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\1es-imaging-catalog-01\1es-imaging\apply-dsc-config.ps1
      scriptArgs: -ConfigFile "C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\1es-imaging-catalog-01\1es-imaging\set-registry-key.dsc.json"
  - name: ~/powershell
    displayName: "Apply DSC BICEP Configuration"
    description: Apply the Desired State Configuration (DSC) via BICEP to the system
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\1es-imaging-catalog-01\1es-imaging\apply-dsc-config.ps1
      scriptArgs: -ConfigFile "C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\1es-imaging-catalog-01\1es-imaging\hello_from_bicep_ext_transitional_powershell_7.dsc.bicep"
  - name: ~/powershell
    displayName: "Deploy 1ES BICEP Configuration"
    description: Deploy the 1ES BICEP to Azure to get outputs
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\1es-imaging-catalog-01\1es-imaging\deploy-bicep.ps1
userTasks:
  - name: ~/powershell
    displayName: "Install Bicep VS Code Extension"
    description: Install Bicep extension for Visual Studio Code
    parameters:
      command: |
        code --install-extension ms-azuretools.vscode-bicep